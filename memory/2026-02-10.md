# 2026-02-10 - Autonominis Darbas (14:07)

## CAMainFlow Core Architecture Analysis

**Užduotis:** Suprasti CAMainFlow kodą - kaip veikia, sintaksė, pattern'ai.
**Rezultatas:** Sukurtas išsamus 20KB skill-analysis dokumentas.

### Išnagrinėti Failai (10 pagrindinių)

1. `ConversationStartedSkill.nslg` - Init flow, state setup
2. `prompt_build_base.nsl` - Bazinis prompt template
3. `prompt_compile_base.nsl` - Prompt compilation level 2
4. `prompt_fast_compile.nsl` - Greitas compilation level 3
5. `Gen2HandleToolCallSkill.nslg` - Tool calling mechanizmas
6. `UserPhoneReplySkill.nslg` - Voice kanalo handling
7. `UserSMSReplySkill.nslg` - SMS kanalo handling
8. `ConversationEndedSkill.nslg` - Cleanup + callback logic
9. `UpdateConversationMetaSkill.nslg` - Metadata/timezone management
10. `get_memory.nsl` - Cross-channel memory aggregation

### Atrasti Pattern'ai

1. **Dual Runner Architecture** - Handlebars (flow) + Jinja2 (prompts)
2. **Atomic Blocks** - `StartNotInterruptibleBlock()` / `StopNotInterruptibleBlock()`
3. **Placeholder-Replace Pattern** - `<||placeholder||>` → actual content
4. **State Buffer Pattern** - Voice buffering dėl transcription delay
5. **Trijų Lygių Prompt Hierarchy** - Build → Compile → Fast Compile
6. **Cross-Channel Memory** - Phone + SMS + Telegram + Email vienoje istorijoje
7. **State Hierarchy** - Global → Persona → Session
8. **Kanalų Abstraction** - Tas pats flow, skirtingi constraint'ai
9. **Event System** - Async system events `SendSystemEvent()`
10. **Tool Calling Gen2** - OpenAI compatible function schema

### NSLG Sintaksės Supratimas

**Handlebars style (.nslg):**
```
{{Set(name="var", value=...)}}
{{#if condition}}...{{/if}}
{{StartNotInterruptibleBlock()}}
```

**Jinja2 style (.nsl):**
```
{% set var = ... %}
{% if condition %}...{% endif %}
{% for item in list %}...{% endfor %}
```

**Sisteminės instrukcijos:**
```
{{#system~}}...{{~/system}}
{{SendSystemEvent(eventIdn="...", ...)}}
{{GetPersonaAttribute(id=user_id, field="...")}}
```

### Akseler Pritaikymui

**Kritiniai failai:**
- `prompt_get_explicit_constraints_voice.nsl` - 15/30 žodžių taisyklės
- `CAAssessmentFlow` - lead scoring (būtina integruoti)
- `CABookingManagementFlow` - susitikimų rezervacija
- `get_memory.nsl` - cross-channel istorija

**Sukurtas dokumentas:** `skill-analysis-camainflow-core-architecture.md`

### Kitas Žingsnis

- Tęsti kitų skill'ų analizę (likę ~70 file'ų)
- Arba pradėti Akseler-specifinių skill'ų kūrimą pagal šią architektūrą
